# วิธีตั้งค่า Fail2ban Whitelist สำหรับ IP ภายใน (Internal IP)

เอกสารนี้สรุปขั้นตอนการตั้งค่า `fail2ban` เพื่อป้องกันไม่ให้แบน (block) IP ที่มาจากเครือข่ายภายใน (เช่น IP ออฟฟิศ) โดยการสร้างไฟล์ `jail.local` ซึ่งจะไป override ค่าใน `jail.conf` โดยไม่ทำให้ไฟล์ตั้งค่าหลักเสียหายเมื่อมีการอัปเดต

---

### ขั้นตอนการตั้งค่าบนเซิร์ฟเวอร์

**1. ไปที่ไดเรกทอรีตั้งค่าของ Fail2ban**

ขั้นแรก ให้เข้าไปยังโฟลเดอร์ที่เก็บไฟล์ config:
```bash
cd /etc/fail2ban


2. สร้างไฟล์ jail.local

เราจะไม่แก้ไข jail.conf โดยตรง ให้เราคัดลอกไฟล์นั้นมาเป็น jail.local แทน:

sudo cp jail.conf jail.local

3. แก้ไขไฟล์ jail.local

เปิดไฟล์ที่เพิ่งสร้างขึ้นมาด้วย text editor (เช่น nano หรือ vi):

sudo nano jail.local

4. เพิ่ม IP ที่ต้องการยกเว้น (Whitelist)

ภายในไฟล์ jail.local ให้ทำดังนี้:

ค้นหาบรรทัดที่ขึ้นต้นด้วย ignoreip (ใน nano ให้กด Ctrl + W แล้วพิมพ์ ignoreip เพื่อค้นหา)

คุณจะเห็นบรรทัดเดิมเป็นแบบนี้:

ignoreip = 127.0.0.1/8 ::1


ให้เพิ่มช่วง IP ภายในของคุณต่อท้ายบรรทัดนั้น โดยเว้นวรรคคั่น (ตัวอย่างนี้จะยกเว้น IP ทั้งหมดที่ขึ้นต้นด้วย 172.16. ซึ่งปลอดภัยสำหรับระบบเครือข่ายภายใน)

แก้ไขให้เป็นดังนี้:

ignoreip = 127.0.0.1/8 ::1 172.16.0.0/16 ( )


บันทึกไฟล์ (ใน nano: กด Ctrl + O > Enter > Ctrl + X)

5. Restart Service ของ Fail2ban

เพื่อให้การตั้งค่าใหม่มีผล ให้สั่ง Restart service:

sudo systemctl restart fail2ban
6. (แนะนำ) ตรวจสอบสถานะ

ตรวจสอบว่า fail2ban กลับมาทำงานปกติหรือไม่:

sudo systemctl status fail2ban